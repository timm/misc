<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>kakmap.rb</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>kakmap.rb</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span></span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Generate a reference sheet for Kakoune&rsquo;s normal mode
Use: ./kakmap.rb ../src/normal.cc</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="nb">require</span><span class="w"> </span><span class="s1">&#39;markaby&#39;</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p>Relies on the keymap HashMap assignment ending with };</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">raw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="no">ARGF</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="w"> </span><span class="sr">/const\s+HashMap&lt;Key,\s*NormalCmd&gt;\s+keymap\s*{/</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">last</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="w"> </span><span class="sr">/^};$/</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">first</span>

<span class="n">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{}</span>

<span class="n">raw</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="w"> </span><span class="sr">/\n+/</span><span class="w"> </span><span class="p">)</span><span class="o">.</span><span class="n">each</span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">line</span><span class="o">|</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p>skip empty or comment line</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="w">  </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">line</span><span class="o">.</span><span class="n">strip</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="n">line</span><span class="o">.</span><span class="n">empty?</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="sr">/^\/\//</span><span class="w"> </span><span class="o">=~</span><span class="w"> </span><span class="n">line</span>
<span class="w">    </span><span class="k">next</span>
<span class="w">  </span><span class="k">end</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>match key mapping line</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="w">  </span><span class="sr">/^\{\s*\{(?&lt;mdky&gt;[^}]+)\}\s*,\s*\{\s*&quot;(?&lt;dsc&gt;[^&quot;]+)&quot;/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">line</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">m</span><span class="o">|</span>
<span class="w">    </span><span class="n">modAndKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="s1">&#39;mdky&#39;</span><span class="o">]</span>
<span class="w">    </span><span class="n">des</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span><span class="o">[</span><span class="s1">&#39;dsc&#39;</span><span class="o">]</span>

<span class="w">    </span><span class="n">modAndKey</span><span class="o">.</span><span class="n">gsub!</span><span class="p">(</span><span class="sr">/\s*\/\*[^*]+\*\/\s*/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1"># remove comment in key definition</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p>match key and modifier</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="w">    </span><span class="sr">/Key::(?&lt;key&gt;\w+)|(?&lt;mod&gt;alt|ctrl)\(&#39;\\?(?&lt;key&gt;.+?)&#39;\)|&#39;\\?(?&lt;key&gt;.+?)&#39;$/</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">modAndKey</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">sm</span><span class="o">|</span>
<span class="w">      </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sm</span><span class="o">[</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
<span class="w">      </span><span class="n">mod</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sm</span><span class="o">[</span><span class="s1">&#39;mod&#39;</span><span class="o">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_sym</span>

<span class="w">      </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Space&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39; &#39;</span>
<span class="w">      </span><span class="n">commands</span><span class="o">[</span><span class="n">key</span><span class="o">]</span><span class="w"> </span><span class="o">||=</span><span class="w"> </span><span class="p">{}</span>
<span class="w">      </span><span class="n">commands</span><span class="o">[</span><span class="n">key</span><span class="o">][</span><span class="n">mod</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">des</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>
<span class="p">}</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p>sort, showing single characters first, symbols next and spelled out keys last</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commands</span><span class="o">.</span><span class="n">sort_by</span><span class="p">{</span><span class="w"> </span><span class="o">|</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">_</span><span class="o">|</span>
<span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="n">key</span>
<span class="w">  </span><span class="k">when</span><span class="w"> </span><span class="sr">/^\w$/</span>
<span class="w">    </span><span class="n">key</span><span class="o">.</span><span class="n">upcase</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span><span class="o">.</span><span class="n">swapcase</span>
<span class="w">  </span><span class="k">when</span><span class="w"> </span><span class="sr">/^\W$/</span>
<span class="w">    </span><span class="s1">&#39;_&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span>
<span class="w">  </span><span class="k">else</span>
<span class="w">    </span><span class="s1">&#39;~~&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">key</span>
<span class="w">  </span><span class="k">end</span>
<span class="p">}</span>

<span class="nb">puts</span><span class="w"> </span><span class="no">Markaby</span><span class="o">::</span><span class="no">Builder</span><span class="o">.</span><span class="n">new</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">html</span><span class="w"> </span><span class="k">do</span>
<span class="w">    </span><span class="n">head</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="n">title</span><span class="w"> </span><span class="s2">&quot;Kakoune default keymap&quot;</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">    </span><span class="n">body</span><span class="w"> </span><span class="k">do</span>
<span class="w">      </span><span class="n">table</span><span class="w"> </span><span class="ss">:style</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;border-collapse: collapse&quot;</span><span class="w"> </span><span class="k">do</span>
<span class="w">        </span><span class="n">thead</span><span class="w"> </span><span class="k">do</span>
<span class="w">          </span><span class="n">tr</span><span class="w"> </span><span class="k">do</span>
<span class="w">            </span><span class="n">th</span><span class="w"> </span><span class="s2">&quot;Key&quot;</span>
<span class="w">            </span><span class="n">th</span><span class="w"> </span><span class="s2">&quot;Description&quot;</span>
<span class="w">            </span><span class="n">th</span><span class="w"> </span><span class="s2">&quot;ALT + key&quot;</span>
<span class="w">            </span><span class="n">th</span><span class="w"> </span><span class="s2">&quot;CTRL + key&quot;</span>
<span class="w">          </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">        </span><span class="n">tbody</span><span class="w"> </span><span class="k">do</span>
<span class="w">          </span><span class="k">for</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="nb">binding</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">commands</span>
<span class="w">            </span><span class="n">tr</span><span class="w"> </span><span class="ss">:style</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;border-bottom: 1px solid #fbfbfb&quot;</span><span class="w"> </span><span class="k">do</span>
<span class="w">              </span><span class="n">th</span><span class="w"> </span><span class="n">key</span>
<span class="w">              </span><span class="n">td</span><span class="w"> </span><span class="nb">binding</span><span class="o">[</span><span class="ss">:none</span><span class="o">]</span>
<span class="w">              </span><span class="n">td</span><span class="w"> </span><span class="nb">binding</span><span class="o">[</span><span class="ss">:alt</span><span class="o">]</span>
<span class="w">              </span><span class="n">td</span><span class="w"> </span><span class="nb">binding</span><span class="o">[</span><span class="ss">:ctrl</span><span class="o">]</span>
<span class="w">            </span><span class="k">end</span>
<span class="w">          </span><span class="k">end</span>
<span class="w">        </span><span class="k">end</span>
<span class="w">      </span><span class="k">end</span>
<span class="w">    </span><span class="k">end</span>
<span class="w">  </span><span class="k">end</span>
<span class="p">}</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
</body>
