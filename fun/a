#!/usr/bin/env ./fun
# vim: filetype=awk ts=2 sw=2 sts=2  et :

@include "lib"

BEGIN {Config(V)}
function Config(i) {
  i.skip = "?"
  i.some.max = 512
}

function Some(i) {
  Object(i)
  i.max= V.some.max
  has(i,"all")
  i.fresh=0
  i.add1="Some1"
}
function adds(a,i,what,  x) {
  what = what ? what : "Some"  
  &what(i)
  for(x in a) add(i,a[x])
}
function add(i,z,  f) { if (z != V.skip)  { i.n++; f=i.add1; &f(i,z) } }

function SomeOk(i)      { i.fresh = asort(i.all)  }
function SomeAdd(i,x,n) { i.fresh = 0; i.all[n]=x }

function Some1(i,x, n) {
  n = len(i.all)
  if (n < i.max)        return SomeAdd(i,x, ++n)
  if (rand() < n/i.max) SomeAdd(i, x, int(n*rand()) + 1)
} 

BEGIN {print DOT,V.some.max}
