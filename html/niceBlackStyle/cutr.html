<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tips and Tricks for Smarter Scipts</title>
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,300" rel="stylesheet" type="text/css">
  <xlink href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
  <link rel="stylesheet" href="b.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.7/css/all.css">
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { fonts: ["TeX"] }
    });
  </script>
  <script type="text/javascript"
     src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js">
   </script>
</head>
<body>
  <div class="container">
    <div class="content">
      <!-- Your content goes here -->
<p><img align=right width=300 src="code.png"></p>
<h1 id="tips-and-tricks-for-smarter-scipts">Tips and Tricks for Smarter Scipts</h1>
<p>Let's write  some code. How to start?</p>
<h2 id="asdads-asd">asdads asd</h2>
<p>asdas
asd
dasdas</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">defpackage</span><span class="w"> </span><span class="ss">:cutr</span><span class="w"> </span><span class="p">(</span><span class="ss">:use</span><span class="w"> </span><span class="ss">:cl</span><span class="p">))</span>
<span class="p">(</span><span class="nb">in-package</span><span class="w"> </span><span class="ss">:cutr</span><span class="p">)</span>
</code></pre></div>

<p>To start writing code for this package, go inside it:</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">defvar</span><span class="w"> </span><span class="vg">*settings*</span><span class="w"> </span>
<span class="w">  </span><span class="o">&#39;</span><span class="p">((</span><span class="nv">about</span><span class="w"> </span><span class="s">&quot;cutr&quot;</span>
<span class="w">           </span><span class="p">(</span><span class="s">&quot;cutr: to understand &#39;it&#39;,  cut &#39;it&#39; up, then seek patterns in&quot;</span><span class="w"> </span>
<span class="w">            </span><span class="s">&quot;the pieces. E.g. here we use cuts for multi- objective,&quot;</span>
<span class="w">            </span><span class="s">&quot;semi- supervised, rule-based explanation.&quot;</span><span class="w">  </span>
<span class="w">            </span><span class="s">&quot;(c) Tim Menzies &lt;timm@ieee.org&gt;, BSD-2 license&quot;</span>
<span class="w">            </span><span class="s">&quot;&quot;</span><span class="p">))</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bins</span><span class="w">      </span><span class="s">&quot;initial number of bins&quot;</span><span class="w">     </span><span class="mi">16</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">bootstrap</span><span class="w"> </span><span class="s">&quot;bootstraps&quot;</span><span class="w">                 </span><span class="mi">256</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">cliffs</span><span class="w">    </span><span class="s">&quot;nonparametric small delta&quot;</span><span class="w">  </span><span class="mf">.147</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">cohen</span><span class="w">     </span><span class="s">&quot;parametric small delta&quot;</span><span class="w">     </span><span class="mf">.35</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">file</span><span class="w">      </span><span class="s">&quot;read data file&quot;</span><span class="w">             </span><span class="s">&quot;../data/auto93.csv&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="k">go</span><span class="w">        </span><span class="s">&quot;start up action&quot;</span><span class="w">            </span><span class="nv">help</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">help</span><span class="w">      </span><span class="s">&quot;show help&quot;</span><span class="w">                  </span><span class="no">nil</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">seed</span><span class="w">      </span><span class="s">&quot;random number seed&quot;</span><span class="w">         </span><span class="mi">1234567891</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">min</span><span class="w">       </span><span class="s">&quot;min size&quot;</span><span class="w">                   </span><span class="mf">.5</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nb">rest</span><span class="w">      </span><span class="s">&quot;exapansion best to rest&quot;</span><span class="w">    </span><span class="mi">3</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">top</span><span class="w">       </span><span class="s">&quot;top items to explore&quot;</span><span class="w">       </span><span class="mi">10</span><span class="p">)</span>
<span class="w">    </span><span class="p">(</span><span class="nv">want</span><span class="w">      </span><span class="s">&quot;optimization goal&quot;</span><span class="w">          </span><span class="nv">plan</span><span class="p">)))</span>
</code></pre></div>

<p>asd asd  asdasaaa</p>
<div class="codehilite"><pre><span></span><code><span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">?</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;alist accessor, defaults to searching `*settings*`&quot;</span>
<span class="w">  </span><span class="o">`</span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="p">(</span><span class="nb">assoc</span><span class="w"> </span><span class="ss">&#39;,x</span><span class="w"> </span><span class="vg">*settings*</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">equalp</span><span class="p">))))</span>

<span class="p">(</span><span class="nb">defmacro</span><span class="w"> </span><span class="nv">o</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="w"> </span><span class="nv">x</span><span class="w"> </span><span class="k">&amp;rest</span><span class="w"> </span><span class="nv">xs</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;nested slot accessor&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">xs</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nv">o</span><span class="w"> </span><span class="p">(</span><span class="nb">slot-value</span><span class="w"> </span><span class="o">,</span><span class="nv">s</span><span class="w"> </span><span class="ss">&#39;,x</span><span class="p">)</span><span class="w"> </span><span class="o">,@</span><span class="nv">xs</span><span class="p">)</span><span class="w"> </span><span class="o">`</span><span class="p">(</span><span class="nb">slot-value</span><span class="w"> </span><span class="o">,</span><span class="nv">s</span><span class="w"> </span><span class="ss">&#39;,x</span><span class="p">)))</span>

<span class="c1">;;;; ----------------------------------------------------------</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">trim</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="p">)</span><span class="w"> </span>
<span class="w">  </span><span class="s">&quot;kill whitespace at start, at end&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">string-trim</span><span class="w"> </span><span class="o">&#39;</span><span class="p">(</span><span class="sc">#\Space</span><span class="w"> </span><span class="sc">#\Tab</span><span class="w"> </span><span class="sc">#\Newline</span><span class="p">)</span><span class="w"> </span><span class="nv">s</span><span class="p">))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">split</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="w"> </span><span class="k">&amp;optional</span><span class="w"> </span><span class="p">(</span><span class="nv">sep</span><span class="w"> </span><span class="sc">#\,</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">filter</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">string2thing</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">here</span><span class="w"> </span><span class="mi">0</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;split  `s`, divided by `sep` filtered through `filter`&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="k">let*</span><span class="w"> </span><span class="p">((</span><span class="nv">there</span><span class="w"> </span><span class="p">(</span><span class="nb">position</span><span class="w"> </span><span class="nv">sep</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="ss">:start</span><span class="w"> </span><span class="nv">here</span><span class="p">))</span>
<span class="w">         </span><span class="p">(</span><span class="nv">word</span><span class="w">  </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="p">(</span><span class="nb">subseq</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nv">here</span><span class="w"> </span><span class="nv">there</span><span class="p">))))</span>
<span class="w">    </span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">tail</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">there</span><span class="w"> </span><span class="p">(</span><span class="nv">split</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="nv">sep</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="p">(</span><span class="nb">1+</span><span class="w"> </span><span class="nv">there</span><span class="p">)))))</span>
<span class="w">      </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">equal</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">tail</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="nv">word</span><span class="w"> </span><span class="p">(</span><span class="nv">tail</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">string2thing</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="w"> </span><span class="k">&amp;aux</span><span class="w"> </span><span class="p">(</span><span class="nv">s1</span><span class="w"> </span><span class="p">(</span><span class="nv">trim</span><span class="w"> </span><span class="nv">s</span><span class="p">)))</span>
<span class="w">  </span><span class="s">&quot;coerce `s` into a number or string or t or nil or #\?&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">equal</span><span class="w"> </span><span class="nv">s1</span><span class="w"> </span><span class="s">&quot;?&quot;</span><span class="p">)</span><span class="w"> </span><span class="sc">#\?</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">equal</span><span class="w"> </span><span class="nv">s1</span><span class="w"> </span><span class="s">&quot;t&quot;</span><span class="p">)</span><span class="w"> </span><span class="no">t</span><span class="p">)</span>
<span class="w">        </span><span class="p">((</span><span class="nb">equal</span><span class="w"> </span><span class="nv">s1</span><span class="w"> </span><span class="s">&quot;nil&quot;</span><span class="p">)</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span>
<span class="w">        </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">n</span><span class="w"> </span><span class="p">(</span><span class="nb">read-from-string</span><span class="w"> </span><span class="nv">s1</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="no">nil</span><span class="p">)))</span><span class="w"> </span>
<span class="w">             </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">numberp</span><span class="w"> </span><span class="nv">n</span><span class="p">)</span><span class="w"> </span><span class="nv">n</span><span class="w"> </span><span class="nv">s1</span><span class="p">)))))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">with-file</span><span class="w"> </span><span class="p">(</span><span class="nv">file</span><span class="w"> </span><span class="nv">fun</span><span class="w"> </span><span class="k">&amp;optional</span><span class="w"> </span><span class="p">(</span><span class="nv">filter</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nv">split</span><span class="p">))</span>
<span class="w">  </span><span class="s">&quot;call `fun` for each line in `file`&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">with-open-file</span><span class="w"> </span><span class="p">(</span><span class="nv">s</span><span class="w"> </span><span class="nv">file</span><span class="p">)</span><span class="w"> </span>
<span class="w">    </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">fun</span><span class="w"> </span><span class="p">(</span><span class="nb">funcall</span><span class="w"> </span><span class="nv">filter</span><span class="w"> </span><span class="p">(</span><span class="nb">or</span><span class="w"> </span><span class="p">(</span><span class="nb">read-line</span><span class="w"> </span><span class="nv">s</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">return</span><span class="p">)))))))</span>


<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">cli</span><span class="w"> </span><span class="p">(</span><span class="nv">flag-help-values</span><span class="p">)</span>
<span class="w">  </span><span class="s">&quot;update values from command line&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">loop</span><span class="w"> </span><span class="nv">for</span><span class="w"> </span><span class="p">(</span><span class="nv">flag</span><span class="w"> </span><span class="nv">help</span><span class="w"> </span><span class="nv">value</span><span class="p">)</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">flag-help-values</span><span class="w"> </span><span class="nv">collect</span>
<span class="w">        </span><span class="p">(</span><span class="k">labels</span><span class="w"> </span><span class="p">((</span><span class="nv">_args</span><span class="w"> </span><span class="p">()</span><span class="w">     </span><span class="o">#+</span><span class="nv">clisp</span><span class="w"> </span><span class="nv">ext:*args*</span><span class="w">  </span><span class="o">#+</span><span class="nv">sbcl</span><span class="w"> </span><span class="nv">sb-ext:*posix-argv*</span><span class="p">)</span>
<span class="w">                 </span><span class="p">(</span><span class="nv">_update</span><span class="w"> </span><span class="p">(</span><span class="nv">arg</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">cond</span><span class="w"> </span><span class="p">((</span><span class="nb">eql</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="no">t</span><span class="p">)</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span>
<span class="w">                                      </span><span class="p">((</span><span class="nb">eql</span><span class="w"> </span><span class="nv">value</span><span class="w"> </span><span class="no">nil</span><span class="p">)</span><span class="w"> </span><span class="no">t</span><span class="p">)</span>
<span class="w">                                      </span><span class="p">(</span><span class="no">t</span><span class="w"> </span><span class="p">(</span><span class="nv">string2thing</span><span class="w"> </span><span class="nv">arg</span><span class="p">)))))</span>
<span class="w">          </span><span class="p">(</span><span class="nb">list</span><span class="w"> </span><span class="nv">flag</span><span class="w"> </span><span class="nv">help</span><span class="w"> </span>
<span class="w">                </span><span class="p">(</span><span class="k">let</span><span class="w"> </span><span class="p">((</span><span class="nv">it</span><span class="w"> </span><span class="p">(</span><span class="nb">member</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">nil</span><span class="w"> </span><span class="s">&quot;--~(~a~)&quot;</span><span class="w"> </span><span class="nv">flag</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">_args</span><span class="p">)</span><span class="w"> </span><span class="ss">:test</span><span class="w"> </span><span class="nf">#&#39;</span><span class="nb">equal</span><span class="p">)))</span>
<span class="w">                  </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="nv">it</span><span class="w"> </span><span class="p">(</span><span class="nv">_update</span><span class="w"> </span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="nv">it</span><span class="p">))</span><span class="w"> </span><span class="nv">value</span><span class="p">))))))</span>

<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">about</span><span class="w"> </span><span class="p">()</span>
<span class="w">  </span><span class="s">&quot;show the `about` part of settings&quot;</span>
<span class="w">  </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="s">&quot;~%~{~a~%~}OPTIONS:~%&quot;</span><span class="w"> </span><span class="p">(</span><span class="nv">?</span><span class="w"> </span><span class="nv">about</span><span class="p">))</span>
<span class="w">  </span><span class="p">(</span><span class="nb">dolist</span><span class="w"> </span><span class="p">(</span><span class="nv">x</span><span class="w"> </span><span class="p">(</span><span class="nb">cdr</span><span class="w"> </span><span class="vg">*settings*</span><span class="p">))</span><span class="w"> </span><span class="p">(</span><span class="nb">format</span><span class="w"> </span><span class="no">t</span><span class="w"> </span><span class="s">&quot;  --~(~10a~) ~a~%&quot;</span><span class="w">  </span><span class="p">(</span><span class="nb">first</span><span class="w"> </span><span class="nv">x</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nb">second</span><span class="w"> </span><span class="nv">x</span><span class="p">))))</span>

<span class="c1">;;;; ----------------------------------------------------------</span>
<span class="p">(</span><span class="nb">defun</span><span class="w"> </span><span class="nv">cutr</span><span class="p">()</span>
<span class="w">  </span><span class="p">(</span><span class="nb">setf</span><span class="w"> </span><span class="vg">*settings*</span><span class="w"> </span><span class="p">(</span><span class="nv">cli</span><span class="w"> </span><span class="vg">*settings*</span><span class="p">))</span>
<span class="w">   </span><span class="p">(</span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nv">?</span><span class="w"> </span><span class="nv">help</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="nv">about</span><span class="p">))</span>
<span class="w">   </span><span class="p">(</span><span class="nb">print</span><span class="w"> </span><span class="p">(</span><span class="nv">?</span><span class="w"> </span><span class="nv">bins</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">cutr</span><span class="p">)</span>
</code></pre></div>    </div>
  </div>
</body>
</html>

